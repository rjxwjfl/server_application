CREATE TABLE user_mst (
  user_id INT AUTO_INCREMENT PRIMARY KEY,
  username VARCHAR(50) NOT NULL,
  password TEXT,
  device_token VARCHAR(255) NOT NULL,
  fb_uid CHAR(32) NOT NULL
);

CREATE TABLE user_dtl (
  user_dtl_id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT NOT NULL,
  create_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  latest_access TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  name VARCHAR(100) NOT NULL,
  contact VARCHAR(50),
  introduce VARCHAR(255) DEFAULT NULL,
  image_url VARCHAR(255) DEFAULT NULL,
  payment_state BOOLEAN NOT NULL DEFAULT FALSE,
  subscription_deadline TIMESTAMP
);

CREATE TABLE user_project (
  user_project_id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT NOT NULL,
  project_id INT NOT NULL
);

CREATE TABLE user_tasks (
  user_task_id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT NOT NULL,
  task_id INT NOT NULL
);

CREATE TABLE payment_info (
  payment_id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT NOT NULL,
  date TIMESTAMP NOT NULL
);

CREATE TABLE project_mst (
  project_id INT AUTO_INCREMENT PRIMARY KEY,
  title VARCHAR(25) NOT NULL,
  category INT NOT NULL,
  master_id INT NOT NULL,
  description VARCHAR(255) NOT NULL,
  goal VARCHAR(255) NOT NULL,
  create_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  start_on TIMESTAMP,
  expire_on TIMESTAMP,
  is_private BOOLEAN NOT NULL DEFAULT 0,
  project_password TEXT
);

CREATE TABLE project_rules (
  rule_id INT AUTO_INCREMENT PRIMARY KEY,
  project_id INT NOT NULL,
  rule VARCHAR(50)
);

CREATE TABLE project_member (
  project_member_id INT AUTO_INCREMENT PRIMARY KEY,
  project_id INT NOT NULL,
  user_id INT NOT NULL,
  role INT NOT NULL DEFAULT 3
);

CREATE TABLE project_milestone (
  project_ms_id INT AUTO_INCREMENT PRIMARY KEY,
  project_id INT NOT NULL,
  task_id INT,
  ms_title VARCHAR(50),
  ms_content VARCHAR(255),
  ms_state BOOLEAN NOT NULL DEFAULT 0
  -- milestone complete date => task complete_at
);

CREATE TABLE task (
  task_id INT AUTO_INCREMENT PRIMARY KEY,
  project_id INT NOT NULL,
  author_id INT NOT NULL,
  manager_id INT,
  title VARCHAR(25) NOT NULL,
  description VARCHAR(255),
  create_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  complete_at TIMESTAMP,
  start_on TIMESTAMP NOT NULL,
  expire_on TIMESTAMP NOT NULL,
  task_state BOOLEAN NOT NULL DEFAULT 0,
  attached TEXT
);

CREATE TABLE task_dtl (
  task_dtl_id INT AUTO_INCREMENT PRIMARY KEY,
  task_id INT NOT NULL,
  pic_id INT NOT NULL,
  description VARCHAR(255),
  progress INT NOT NULL DEFAULT 0,
  evaluation INT NOT NULL DEFAULT 0,
  attached TEXT
);

CREATE TABLE task_comment (
  task_comment_id INT AUTO_INCREMENT PRIMARY KEY,
  task_id INT NOT NULL,
  author_id INT NOT NULL,
  content VARCHAR(255) NOT NULL,
  create_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE task_comment_reply(
  task_reply_id	INT AUTO_INCREMENT PRIMARY KEY,
  task_comment_id INT NOT NULL,
  author_id INT NOT NULL,
  content VARCHAR(255) NOT NULL,
  create_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE feed (
  feed_id INT AUTO_INCREMENT PRIMARY KEY,
  project_id INT NOT NULL,
  title VARCHAR(25) NOT NULL,
  author_id INT NOT NULL,
  content VARCHAR(255) NOT NULL,
  create_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE feed_comment (
  feed_comment_id INT AUTO_INCREMENT PRIMARY KEY,
  feed_id INT NOT NULL,
  author_id INT NOT NULL,
  content VARCHAR(255) NOT NULL,
  create_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE feed_comment_reply(
  feed_reply_id	INT AUTO_INCREMENT PRIMARY KEY,
  feed_comment_id INT NOT NULL,
  author_id INT NOT NULL,
  content VARCHAR(255) NOT NULL,
  create_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);